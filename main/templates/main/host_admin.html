{% extends "main/base.html" %}
{% load i18n %}

{% block content %}

    <div class="text-center mb-4">
        <h2>{% if host.title %}{{ host.title }}{% endif %} {% if host.first_name %}{{ host.first_name }}{% endif %} {{host.last_name}}</h2>
        <h4 class="text-muted">{% trans "Prise en charge d'un rendez-vous prévu à" %}</h2>
    </div>

    <div class="d-flex justify-content-center">
        <form action="{% url 'host_admin' host.slug %}" method="POST" id="pickup-form">
            <div class="d-flex align-items-center">
                <div class="d-flex flex-column">
                    <div class="time-control text-primary" v-on:click="increase_hour"><i class="fa fa-plus-circle"></i></div>
                    <div><input class="form-control" type="text" v-model="scheduled_hours" v-on:blur="format_hour"></div>
                    <div class="time-control text-primary" v-on:click="decrease_hour"><i class="fa fa-minus-circle"></i></div>
                </div>
                
                <span class="text-muted separator">:</span>
                
                <div class="d-flex flex-column">
                    <div class="time-control text-primary" v-on:click="increase_minutes"><i class="fa fa-plus-circle"></i></div>
                    <div><input class="form-control" type="text" v-model="scheduled_minutes" v-on:blur="format_minutes"></div>
                    <div class="time-control text-primary" v-on:click="decrease_minutes"><i class="fa fa-minus-circle"></i></div>
                </div>
            </div>
            <input id="id_scheduled_time" name="scheduled_time" v-model="scheduled_time" type="hidden">
            {% csrf_token %}
            <button class="btn btn-block btn-lg btn-primary mt-4">Prise en charge</button>
        </form>
    </div>

    {% if picked_up %}
        <i>Prise en charge du rendez-vous de {{ appointment.scheduled_time }}{% if delay.total_seconds > 0 %} (avec un retard de {{delay}}){% endif %}</i>
    {% endif %}

    <script type="text/javascript">
        document.onready = function() {

            var MINUTES_STEP = 15;
            
            new Vue({
                delimiters: ['[[', ']]'],
                el: '#pickup-form',
                data: {
                    scheduled_hours: '15',
                    scheduled_minutes: '13'
                },
                computed: {
                    scheduled_time: function() {
                        var u = this.$options.utils;
                        return u.format(this.scheduled_hours)+':'+u.format(this.scheduled_minutes);
                    }
                },
                utils: {
                    zero_pad: function(input) {
                        if(input < 10 && input > 0) return '0'+input;
                        else if(input == 0) return '00';
                        else return input+'';
                    },
                    format: function(input) {
                        return this.zero_pad(parseInt(input));
                    }
                },
                methods: {
                    increase_hour: function() {
                        h = parseInt(this.scheduled_hours);
                        u = this.$options.utils;
                        this.scheduled_hours = (h+1 >= 24) ? 0 : h+1;
                        this.scheduled_hours = u.format(this.scheduled_hours);
                    },
                    decrease_hour: function() {
                        h = parseInt(this.scheduled_hours);
                        u = this.$options.utils;
                        this.scheduled_hours = (h-1 < 0 ) ? 23 : h-1;
                        this.scheduled_hours = u.format(this.scheduled_hours);
                    },
                    increase_minutes: function() {
                        h = parseInt(this.scheduled_minutes);
                        u = this.$options.utils;
                        this.scheduled_minutes = (h+MINUTES_STEP >= 60) ? 0 : h+MINUTES_STEP;
                        this.scheduled_minutes = u.format(this.scheduled_minutes);
                    },
                    decrease_minutes: function() {
                        h = parseInt(this.scheduled_minutes);
                        u = this.$options.utils;
                        this.scheduled_minutes = (h-MINUTES_STEP < 0 ) ? 60-MINUTES_STEP : h-MINUTES_STEP;
                        this.scheduled_minutes = u.format(this.scheduled_minutes);
                    },
                    format_hour: function() {
                        var u = this.$options.utils;
                        this.scheduled_hours = u.format(this.scheduled_hours);
                    },
                    format_minutes: function() {
                        var u = this.$options.utils;
                        this.scheduled_minutes = u.format(this.scheduled_minutes);
                    }
                }
            })
        }
    </script>
    
{% endblock content %}